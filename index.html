<!Doctype html>
<html>
<head>
<title>Game Controller Overlay</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<style>
* {
  -webkit-overflow-scrolling: none;
}

html, body, canvas {
  margin: 0;
  padding: 0;
  border: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
h1 {
  postion: absolute;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  font-size: 16px;
}
</style>
<script>
!function(t,n){"use strict";function e(t,n){var e=document.createElement("canvas"),i=2*t;e.width=i,e.height=i,e.style.cssText=["width:"+i+"px","height:"+i+"px"].join(";");var r=e.getContext("2d");return r.beginPath(),r.fillStyle=n,r.arc(t,t,t,0,x,!1),r.fill(),e}function i(){return Date.now()}function r(t){setTimeout(t,10)}function o(t,n){return Object.keys(n).forEach(function(e){t[e]=n[e]}),t}function a(t,n){return n.x<t.x+t.radius&&n.x>t.x-t.radius&&n.y<t.y+t.radius&&n.y>t.y-t.radius}function c(t){return t>1?1:-1>t?-1:t}function s(){}function u(t){for(var n=0;n<p.length;n++)if(t&&a(p[n],{x:t.startX,y:t.startY}))return E[n].nx=0,E[n].ny=0,E[n].isDown=!1,t}function d(t){for(var n,e=0;e<p.length;e++)if(n=p[e],t&&a(n,{x:t.startX,y:t.startY}))return E[e].nx=c((t.x-n.x)/n.radius),E[e].ny=c((t.y-n.y)/n.radius),E[e].isDown=!0,t}function h(t){t.preventDefault();for(var n,e=0;e<t.changedTouches.length;e++)n=t.changedTouches[e],b[n.identifier]=d({startX:n.clientX,startY:n.clientY,x:n.clientX,y:n.clientY})}function f(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;n++){var e=t.changedTouches[n];if(!b[e.identifier])return;b[e.identifier].x=e.clientX,b[e.identifier].y=e.clientY,d(b[e.identifier])}}function l(t){t.preventDefault();for(var e,i=0;i<t.changedTouches.length;i++)e=t.changedTouches[i].identifier,u(b[e]),b[e]=n}var y,g,v,x=2*Math.PI,p=[],m=["width: 100%","height: 100%","margin: 0","padding: 0","border: 0","overflow: hidden","position: fixed","top: 0","left: 0","bottom: 0","right: 0"].join(";"),E=[],w={top:function(t,n){t.y=n},right:function(n,e){n.x=t.innerWidth-e},bottom:function(n,e){n.y=t.innerHeight-e},left:function(t,n){t.x=n}},b=[];s.prototype.init=function(t){return o(this,t),this.id=i(),this.image=e(this.radius,t.color),Object.keys(t).forEach(function(n){w[n]&&w[n](this,t[n])},this),E.push({nx:0,ny:0,isDown:!1}),this},s.prototype.draw=function(t){t.drawImage(this.image,this.x-this.radius,this.y-this.radius)};var T={outputs:E,createCircleImage:e,init:function(n){function e(){y.width=t.innerWidth,y.height=t.innerHeight,r(function(){p.forEach(function(t){Object.keys(t).forEach(function(n){w[n]&&w[n](t,t[n])},this),t.draw(g)})})}y||(v=n.parentElement||document.body,y=n.canvas||document.createElement("canvas"),g=y.getContext("2d"),p=[],y.style.cssText=m,y.parentElement||v.appendChild(y),n.controls.forEach(function(t){p.push((new s).init(t))}),t.addEventListener("resize",e),e())},enable:function(){y&&(y.style.display="block",y.addEventListener("touchstart",h),y.addEventListener("touchmove",f),y.addEventListener("touchend",l))},disable:function(){y&&(y.style.display="none",y.addEventListener("touchstart",h),y.addEventListener("touchmove",f),y.addEventListener("touchend",l))}};t.GameController=T}(window);
</script>
</head>
<body>
<h1>Only touch capable.</h1>
<canvas></canvas>

<script>
/* globals GameController */

(function(){
  'use strict';

  var canvas = document.getElementsByTagName('canvas')[0];
  var context = canvas.getContext('2d');

  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener(resize);
  resize();

  GameController.init({
    controls: [{
      left: 60,
      bottom: 60,
      radius: 30,
      color: 'rgba(0,0,0,0.7)'
    }, {
      right: 60,
      bottom: 60,
      radius: 20,
      color: 'rgba(255,0,0,0.7)'
    }]
  });
  GameController.enable();

  var o = {
    x: window.innerWidth / 2,
    y: window.innerHeight / 2,
    r: 10,
    c: 'rgba(0,255,0,1)'
  };
  o.image = GameController.createCircleImage(o.r, o.c);
  var outputs = GameController.outputs;
  var joystick = outputs[0];
  var buttonA = outputs[1];

  function update (){
    requestAnimationFrame(update);

    o.x += joystick.nx < 0 ? -1 : joystick.nx > 0 ? 1 : 0;
    o.y += joystick.ny < 0 ? -1 : joystick.ny > 0 ? 1 : 0;

    if (buttonA.isDown){
      o.x = window.innerWidth / 2;
      o.y = window.innerHeight / 2;
    }

    context.clearRect(0,0,window.innerWidth, window.innerHeight);
    context.drawImage(o.image, o.x - o.r, o.y - o.r);
  }
  update();
})();
</script>
</body>
</html>
