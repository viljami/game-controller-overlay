<!Doctype html>
<html>
<head>
<title>Game Controller Overlay</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<style>
* {
  -webkit-overflow-scrolling: none;
}

html, body, canvas {
  margin: 0;
  padding: 0;
  border: 0;
  width: 100%;
  height: 100%;
}
h1 {
  postion: absolute;
  top: 0;
  left: 0;
  margin: 0;
  padding: 0;
  font-size: 16px;
}
</style>
<script>
!function(t,n){"use strict";function e(){return Date.now()}function i(t){setTimeout(t,10)}function r(t,n){return Object.keys(n).forEach(function(e){t[e]=n[e]}),t}function o(t){return t>1?1:-1>t?-1:t}function c(t,n){return n.x<t.x+t.radius&&n.x>t.x-t.radius&&n.y<t.y+t.radius&&n.y>t.y-t.radius}function a(t,n){var e=document.createElement("canvas"),i=2*t;e.width=i,e.height=i,e.style.cssText=["width:"+i+"px","height:"+i+"px"].join(";");var r=e.getContext("2d");return r.beginPath(),r.fillStyle=n,r.arc(t,t,t,0,g,!1),r.fill(),e}function u(){}function s(t){for(var n=0;n<y.length;n++)if(t&&c(y[n],{x:t.startX,y:t.startY}))return v[n].nx=0,v[n].ny=0,v[n].isDown=!1,t}function h(t){for(var n,e=0;e<y.length;e++)if(n=y[e],t&&c(n,{x:t.startX,y:t.startY}))return v[e].nx=o((t.x-n.x)/n.radius),v[e].ny=o((t.y-n.y)/n.radius),v[e].isDown=!0,t}function d(t){t.preventDefault();for(var n,e=0;e<t.changedTouches.length;e++)n=t.changedTouches[e],p[n.identifier]=h({startX:n.clientX,startY:n.clientY,x:n.clientX,y:n.clientY})}function f(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;n++){var e=t.changedTouches[n];p[e.identifier].x=e.clientX,p[e.identifier].y=e.clientY,h(p[e.identifier])}}function l(t){t.preventDefault();for(var e,i=0;i<t.changedTouches.length;i++)e=t.changedTouches[i].identifier,s(p[e]),p[e]=n}var g=2*Math.PI,y=[],x=["width: 100%","height: 100%","margin: 0","padding: 0","border: 0","overflow: hidden","position: fixed","top: 0","left: 0"].join(";"),v=[],p=[],w={top:function(t,n){t.y=n},right:function(n,e){n.x=t.innerWidth-e},bottom:function(n,e){n.y=t.innerHeight-e},left:function(t,n){t.x=n}};u.prototype.init=function(t){r(this,t),this.id=e(),this.image=a(this.radius,t.color),Object.keys(t).forEach(function(n){w[n]&&w[n](this,t[n])},this),y.push(this),v.push({nx:0,ny:0,isDown:!1})},u.prototype.draw=function(t){t.drawImage(this.image,this.x-this.radius,this.y-this.radius)};var m={outputs:v,createCircleImage:a,init:function(n){function e(){r.width=t.innerWidth,r.height=t.innerHeight,i(function(){y.forEach(function(t){Object.keys(t).forEach(function(n){w[n]&&w[n](t,t[n])},this),t.draw(o)})})}var r=document.createElement("canvas"),o=r.getContext("2d");r.style.cssText=x,document.body.appendChild(r);new u,new u;n.controls.forEach(function(t){(new u).init(t)}),r.addEventListener("touchstart",d),r.addEventListener("touchmove",f),r.addEventListener("touchend",l),t.addEventListener("resize",e),e()}};t.GameController=m}(window);
</script>
</head>
<body>
<h1>Only touch capable.</h1>
<canvas></canvas>

<script>
/* globals GameController */

(function(){
  'use strict';

  var canvas = document.getElementsByTagName('canvas')[0];
  var context = canvas.getContext('2d');

  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener(resize);
  resize();

  GameController.init({
    controls: [{
      left: 60,
      bottom: 60,
      radius: 30,
      color: 'rgba(0,0,0,0.7)'
    }, {
      right: 60,
      bottom: 60,
      radius: 20,
      color: 'rgba(255,0,0,0.7)'
    }]
  });

  var o = {
    x: 100,
    y: 100,
    r: 10,
    c: 'rgba(0,255,0,1)'
  };
  o.image = GameController.createCircleImage(o.r, o.c);
  var outputs = GameController.outputs;

  function update (){
    requestAnimationFrame(update);

    o.x += outputs[0].nx < 0 ? -1 : outputs[0].nx > 0 ? 1 : 0;
    o.y += outputs[0].ny < 0 ? -1 : outputs[0].ny > 0 ? 1 : 0;

    context.clearRect(0,0,window.innerWidth, window.innerHeight);
    context.drawImage(o.image, o.x - o.r, o.y - o.r);
  }
  update();
})();
</script>
</body>
</html>
